{% extends 'base.html.twig' %}

{% block title %}Review Details{% endblock %}

{% block body %}
    <div class="container mt-5">
        <h1 class="mb-4">
            <i class="bi bi-chat-square-text me-2"></i>Review for
            <span class="text-primary">{{ review.book.title }}</span>
        </h1>

        <div class="card shadow-sm">
            <div class="card-body">
                <p><strong>Review Text:</strong></p>
                <p class="fst-italic">{{ review.reviewtext }}</p>

                <p><strong>Rating:</strong>
                    {% for i in 1..5 %}
                        {% if i <= review.rating %}
                            <i class="bi bi-star-fill text-warning"></i>
                        {% else %}
                            <i class="bi bi-star text-muted"></i>
                        {% endif %}
                    {% endfor %}
                </p>

                <p><strong>Reviewed by:</strong> <i class="bi bi-person-fill me-1"></i>{{ review.user.email }}</p>

                {% if app.user == review.user %}
                    <div class="mt-3">
                        <a href="{{ path('app_review_edit', {'id': review.id}) }}" class="btn btn-outline-primary me-2">
                            <i class="bi bi-pencil-square"></i> Edit
                        </a>
                        <a href="{{ path('app_review_delete', {'id': review.id}) }}"
                           class="btn btn-outline-danger"
                           onclick="return confirm('Are you sure you want to delete this review?')">
                            <i class="bi bi-trash"></i> Delete
                        </a>
                    </div>
                    <h3>Comments</h3>
                    {% if comments is empty %}
                        <p>No comments yet.</p>
                    {% else %}
                        <ul>
                            {% for comment in comments %}
                                <li>
                                    <strong>{{ comment.author.username ?: comment.author.email }}</strong>
                                    ({{ comment.createdAt|date('Y-m-d H:i') }}):
                                    <p>{{ comment.content }}</p>
                                    {# Optional: Show replies if you have threaded comments #}
                                    {% if comment.replies|length > 0 %}
                                        <ul>
                                            {% for reply in comment.replies %}
                                                <li>
                                                    <strong>{{ reply.author.username }}</strong>
                                                    ({{ reply.createdAt|date('Y-m-d H:i') }}):
                                                    <p>{{ reply.text }}</p>
                                                </li>
                                            {% endfor %}
                                        </ul>
                                    {% endif %}
                                </li>
                            {% endfor %}
                        </ul>
                    {% endif %}
                    <a href="{{ path('app_comment_create', {'reviewId': review.id}) }}">Add a Comment</a>
                {% endif %}
            </div>
        </div>
        <a href="{{ path('app_review_list') }}" class="btn btn-link mt-4">
            <i class="bi bi-arrow-left-circle"></i> Back to Reviews
        </a>
    </div>
{% endblock %}