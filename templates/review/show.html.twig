{% extends 'base.html.twig' %}

{% block title %}Review Details{% endblock %}

{% block body %}
    <h1>Review for {{ review.book.title }}</h1>

    <p><strong>Review Text:</strong></p>
    <p>{{ review.reviewText }}</p>

    <p><strong>Rating:</strong> {{ review.rating }}/5</p>

    <p><strong>Reviewed by:</strong> {{ review.user.email }}</p>

    {% if app.user == review.user %}
        <div>
            <a href="{{ path('app_review_edit', {'id': review.id}) }}">Edit Review</a> |
            <a href="{{ path('app_review_delete', {'id': review.id}) }}"
               onclick="return confirm('Are you sure you want to delete this review?')">
                Delete Review
            </a>
        </div>

        <h2>Comments</h2>
        {% if comments is empty %}
            <p>No comments yet.</p>
        {% else %}
            <ul>
                {% for comment in comments %}
                    <li>
                        <strong>{{ comment.author.username ?: comment.author.email }}</strong>
                        ({{ comment.createdAt|date('Y-m-d H:i') }}):
                        <p>{{ comment.content }}</p>
                        {% if comment.replies|length > 0 %}
                            <ul>
                                {% for reply in comment.replies %}
                                    <li>
                                        <strong>{{ reply.author.username }}</strong>
                                        ({{ reply.createdAt|date('Y-m-d H:i') }}):
                                        <p>{{ reply.text }}</p>
                                    </li>
                                {% endfor %}
                            </ul>
                        {% endif %}
                    </li>
                {% endfor %}
            </ul>
        {% endif %}
        <a href="{{ path('app_comment_create', {'reviewId': review.id}) }}">Add a Comment</a>
    {% endif %}

    <p><a href="{{ path('app_review_list') }}">Back to Reviews</a></p>
{% endblock %}
